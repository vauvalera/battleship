!function(e){var t={};function s(i){if(t[i])return t[i].exports;var l=t[i]={i:i,l:!1,exports:{}};return e[i].call(l.exports,l,l.exports,s),l.l=!0,l.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)s.d(i,l,function(t){return e[t]}.bind(null,l));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);var i={getElement:e=>document.querySelector(e),getRandom:e=>Math.floor(Math.random()*e),getFromCoordByAlign:(e,t,s)=>e+t*s<=9&&1==t?e+t*s+1:e+t*s==9&&1==t?e+t*s:9==e&&0==t?e+1:e<9&&0==t?e+2:void 0,getToCoord:e=>e>0?e-1:e};class l{constructor(e,t){this.field=e,this.player=t,this.ships=[],this.size=10,this.matrix=[],this.killedShipsCount=0,this.shotsList="user"==t?this.generateShotsList(this.size):null}createNewField(){this.matrix=[this.size];for(let e=0;e<this.size;e++){this.matrix[e]=[this.size];for(let t=0;t<this.size;t++)this.matrix[e][t]=0}}isAvailableCoordinats({decks:e,x:t,y:s,kx:l,ky:r}){let o=i.getToCoord(t),a=i.getFromCoordByAlign(t,l,e),n=i.getToCoord(s),d=i.getFromCoordByAlign(s,r,e);for(let e=o;e<a;e++)for(let t=n;t<d;t++)if(0!=this.matrix[t][e])return!1;return!0}addShipToField(e){this.ships.push(e);for(let t=0;t<e.decks;t++)this.matrix[e.y+t*e.ky][e.x+t*e.kx]=this.ships.length,e.cordinats.push([e.y+t*e.ky,e.x+t*e.kx])}getCoordinatsByDecks(e){const t=Math.round(Math.random()),s=t>0?0:1,l=s>0?i.getRandom(10-e):i.getRandom(10),r=s>0?i.getRandom(10):i.getRandom(10-e);return this.isAvailableCoordinats({decks:e,x:r,y:l,kx:t,ky:s})?{x:r,y:l,kx:t,ky:s,decks:e}:this.getCoordinatsByDecks(e)}generateShotsList(e){if(!e)return;const t=[];for(let s=0;s<e;s++)for(let i=0;i<e;i++)t.push([s,i]);return t}drawField(){this.field.innerHTML="",this.matrix.forEach((e,t)=>{const s=document.createElement("div");s.className="row",this.field.appendChild(s),e.forEach((e,i)=>{const l=document.createElement("div");l.className=e>0&&e<11?"user"==this.player?"ship":"cell":-1==e?"dot":15==e?"kill":"cell",l.dataset.rowIndex=`${t}`,l.dataset.cellIndex=`${i}`,s.appendChild(l)})})}}class r{constructor({decks:e,x:t,y:s,kx:i,ky:l}){this.decks=e,this.x=t,this.y=s,this.kx=i,this.ky=l,this.hits=0,this.cordinats=[]}addHit(){this.hits++}isDead(){return this.hits==this.decks}}i.getElement(".battleship-btn_start").addEventListener("click",e=>{const t=i.getElement(".battleship-field-user");let s=t&&new l(t,"user");s.createNewField();const o=i.getElement(".battleship-field-computer");let a=o&&new l(o,"comp");a.createNewField(),[4,3,3,2,2,2,1,1,1,1].forEach(e=>{const t=s.getCoordinatsByDecks(e),i=new r(t);s.addShipToField(i);const l=a.getCoordinatsByDecks(e),o=new r(l);a.addShipToField(o)}),s.drawField(),a.drawField(),s.field.style.display="block",a.field.style.display="block",i.getElement(".battleship-btn_play").setAttribute("hidden",!0),i.getElement(".battleship-btn_title").setAttribute("hidden",!0);const n=i.getElement(".battleship-user-name").value;i.getElement("#battleship-form").style.display="none",i.getElement(".battleship-overlay").style.display="none",new class{constructor(e,t){this.steps=0,this.player=null,this.userField=e,this.compField=t,this.activeField=null,this.serviseText=i.getElement(".battleship-btn_servise-text"),this.username=""}init(e){self=this,this.username=e;var t=i.getRandom(2);self.player=0==t?"user":"comp","user"===self.player?(self.compField.field.addEventListener("click",self.shoot),self.activeField=self.compField,self.showServiseText("Вы стреляете первым.")):(self.activeField=self.userField,self.showServiseText("Первым стреляет компьютер."),self.nextShot())}shoot(e){let t,s;if(void 0!==e?(t=e.target.dataset.cellIndex,s=e.target.dataset.rowIndex):[s,t]=self.getCoordinatesShot(),void 0==t||void 0==s)return self.showServiseText("user"==self.player?`${self.username}, Вы попали в решетку, повторите выстрел.`:""),void self.nextShot();switch(self.activeField.matrix[s][t]){case 0:self.setMissedShot(t,s),self.activeField.drawField(),self.showServiseText("user"==self.player?`${self.username}, Вы промахнулись. Ходит комьютер`:"Компьютер промахнулся. Ваш ход."),self.changePlayer(),self.changeActiveField(),self.nextShot();break;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:const e=self.getShipByMatrixCoordinats(t,s);if(e.addHit(),e.isDead()&&(self.surroundShip(e),self.increaseKilledShips()),self.setHittedShot(t,s),self.activeField.drawField(),self.isEndOfGame())return self.showServiseText("user"==self.player?`Вы выйграли, ${self.username}!`:"Компьютер выйграл!"),void self.compField.field.removeEventListener("click",self.shoot);self.showServiseText("user"==self.player?`${self.username}, Вы попали в корабль!`:"Компьютер попал, ходит еще раз!"),self.nextShot();break;default:"comp"==self.player?setTimeout(function(){return self.shoot()},1e3):self.showServiseText("В данную клетку стрелять нельзя. Выберите другую!")}}changeActiveField(){this.activeField="comp"==this.player?this.userField:this.compField}changePlayer(){this.player="comp"==this.player?"user":"comp"}nextShot(){"comp"==self.player?(self.compField.field.removeEventListener("click",self.shoot),self.compShot()):self.activeField.field.addEventListener("click",self.shoot)}compShot(){setTimeout(function(){self.shoot()},500)}setMissedShot(e,t){self.activeField.matrix[t][e]=-1}getShipByMatrixCoordinats(e,t){return self.activeField.ships[self.activeField.matrix[t][e]-1]}setHittedShot(e,t){self.activeField.matrix[t][e]=15}showServiseText(e){this.serviseText.innerHTML=e}surroundShip(e){let t=i.getToCoord(e.x),s=i.getFromCoordByAlign(e.x,e.kx,e.decks),l=i.getToCoord(e.y),r=i.getFromCoordByAlign(e.y,e.ky,e.decks);for(let e=t;e<s;e++)for(let t=l;t<r;t++)0==self.activeField.matrix[t][e]&&(self.activeField.matrix[t][e]=-1)}increaseKilledShips(){self.activeField.killedShipsCount++}isEndOfGame(){return 10==self.activeField.killedShipsCount}getCoordinatesShot(){const e=self.activeField.shotsList[i.getRandom(self.activeField.shotsList.length)];return self.activeField.shotsList=self.activeField.shotsList.filter(t=>t!=e),e}}(s,a).init(n),e.preventDefault()}),i.getElement("#play").addEventListener("click",e=>{i.getElement("#battleship-form").style.display="block",i.getElement(".battleship-overlay").style.display="block"})}]);